<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pandavyv Donations</title>
<script src="https://cdn.jsdelivr.net/npm/@tonconnect/sdk@0.7.4/dist/tonconnect-sdk.min.js"></script>
</head>
<body>
<h1>Поддержите Pandavyv.ru!</h1>
<div id="tonAddress">Адрес: pandareborn.ton</div>
<textarea id="comment" placeholder="Комментарий"></textarea>
<br>
<button id="connectWallet">Подключить кошелёк</button>
<button onclick="sendDonation(1)">1 TON</button>
<button onclick="sendDonation(5)">5 TON</button>

<script>
let tonConnect;
let walletAddress = null;

async function initTONConnect() {
    tonConnect = new TonConnect({ manifestUrl: "https://pandavyv.onrender.com/manifest.json" });
    tonConnect.onStatusChange((wallet) => {
        if(wallet){
            walletAddress = wallet.account.address;
            document.getElementById('connectWallet').innerText = "Кошелёк подключен ✅";
        } else {
            walletAddress = null;
            document.getElementById('connectWallet').innerText = "Подключить кошелёк";
        }
    });

    document.getElementById('connectWallet').onclick = async () => {
        if(!walletAddress) await tonConnect.connect();
    };
}

async function sendDonation(amount){
    const comment = document.getElementById('comment').value.trim();
    if(!walletAddress){ alert("Сначала подключите кошелёк!"); return; }
    const tx = await tonConnect.sendTransaction({
        validUntil: Math.floor(Date.now()/1000)+600,
        messages:[{address:"pandareborn.ton", amount:amount*1_000_000_000, payload:comment}]
    });
    alert(`Донат ${amount} TON отправлен!`);
    document.getElementById('comment').value="";
}

window.addEventListener('load', initTONConnect);
</script>
</body>
</html>
